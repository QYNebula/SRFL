---
import Header from '../components/Header.astro'; 
import Footer from '../components/Footer.astro'; 

interface Props {
    title: string;
	lang?: 'en' | 'fr';
}

const { title, lang = 'fr' } = Astro.props;
---

<!doctype html>
<html lang={lang}> <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title}</title>
    </head>
    <body>
        <div class="cursor-dot"></div>
        <div class="cursor-outline"></div>
        
        <Header currentLang={lang} /> 

        <div class="page-content">
            <slot />
        </div>
        <Footer />
    </body>

    <script is:inline>
        (function() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const config = {
                colors: ['#ff4444', '#ffae00', '#edba3a'],
                count: 150,
                range: 100,
                trailCount: 20 
            };
            canvas.style.cssText = "position:fixed;top:0;left:0;z-index:-1;pointer-events:none;";
            document.body.appendChild(canvas);
            let width, height, sparks = [], trails = [];
            const mouse = { x: null, y: null };
            function init() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
                sparks = [];
                for (let i = 0; i < config.count; i++) {
                    sparks.push({
                        x: Math.random() * width,
                        y: Math.random() * height,
                        size: Math.random() * 4.5,
                        color: config.colors[Math.floor(Math.random() * config.colors.length)],
                        opacity: Math.random() * 0.4 + 0.1,
                        speed: Math.random() * 0.2
                    });
                }
            }
            window.addEventListener('resize', init);
            window.addEventListener('mousemove', e => {
                mouse.x = e.clientX;
                mouse.y = e.clientY;
                for (let i = 0; i < 2; i++) {
                    trails.push({
                        x: mouse.x,
                        y: mouse.y,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        size: Math.random() * 3 + 1,
                        life: 1.0,
                        color: config.colors[Math.floor(Math.random() * config.colors.length)]
                    });
                }
            });
            init();
            function draw() {
                ctx.clearRect(0, 0, width, height);
                sparks.forEach(s => {
                    s.y -= s.speed;
                    if (s.y < 0) s.y = height;
                    let drawOpacity = s.opacity;
                    let drawSize = s.size;
                    if (mouse.x !== null) {
                        const dx = s.x - mouse.x;
                        const dy = s.y - mouse.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < config.range) {
                            const r = 1 - dist / config.range;
                            drawOpacity = Math.min(1.0, s.opacity + r * 0.8);
                            drawSize = s.size * (1 + r * 2);
                        }
                    }
                    ctx.fillStyle = s.color;
                    ctx.globalAlpha = drawOpacity;
                    ctx.beginPath();
                    const spikes = 5;
                    const outerRadius = drawSize;
                    const innerRadius = drawSize * 0.5;
                    let rot = Math.PI / 2 * 3;
                    let step = Math.PI / spikes;
                    ctx.moveTo(s.x, s.y - outerRadius);
                    for (let i = 0; i < spikes; i++) {
                        ctx.lineTo(s.x + Math.cos(rot) * outerRadius, s.y + Math.sin(rot) * outerRadius);
                        rot += step;
                        ctx.lineTo(s.x + Math.cos(rot) * innerRadius, s.y + Math.sin(rot) * innerRadius);
                        rot += step;
                    }
                    ctx.closePath();
                    ctx.fill();
                });
                for (let i = trails.length - 1; i >= 0; i--) {
                    const t = trails[i];
                    t.x += t.vx; t.y += t.vy; t.life -= 0.02; t.size *= 0.96;
                    if (t.life <= 0) { trails.splice(i, 1); continue; }
                    ctx.globalAlpha = t.life;
                    ctx.fillStyle = t.color;
                    ctx.beginPath();
                    ctx.arc(t.x, t.y, t.size, 0, Math.PI * 2);
                    ctx.fill();
                }
                requestAnimationFrame(draw);
            }
            draw();
        })();
    </script>
</html>

<style is:global>
    /* 1. 全局鼠标隐藏增强 */
    html, body {
        margin: 0;
        height: 100%;
        cursor: none !important; /* 强制所有地方隐藏 */
        user-select: none;
        -webkit-user-select: none;
        caret-color: transparent; /* 隐藏输入框闪烁的光标 */
    }

    /* 2. 针对标题、说明文字、输入框的补充隐藏 */
    h1, h2, h3, h4, h5, h6, p, span, label, textarea, input, .section-title, .status-tag {
        cursor: none !important;
    }

    body {
        display: flex;
        flex-direction: column;
        background: #13151a;
        color: #ffffff;
        font-family: 'Segoe UI', sans-serif;
    }

    .page-content {
        padding-top: 70px;
        flex: 1 0 auto;
    }

    /* 强制所有可点击元素不显示默认鼠标样式 */
    a, button, select, .social-btn, .menu-item {
        cursor: none !important;
    }

    .cursor-dot {
        position: fixed;
        top: 0; left: 0;
        width: 12px; height: 12px;
        transform: translate(-50%, -50%);
        z-index: 10000;
        pointer-events: none;
    }

    .cursor-dot::before,
    .cursor-dot::after {
        content: '';
        position: absolute;
        background-color: var(--dot-color, #ff4444);
        transition: background-color 0.2s ease;
    }

    .cursor-dot::before { top: 5px; left: 0; width: 12px; height: 2px; }
    .cursor-dot::after { top: 0; left: 5px; width: 2px; height: 12px; }

    .cursor-outline {
        width: 35px; height: 35px;
        border: 2px solid rgba(237, 186, 58, 0.5);
        position: fixed;
        top: 0; left: 0;
        transform: translate(-50%, -50%);
        border-radius: 50%;
        z-index: 9999;
        pointer-events: none;
        transition: width 0.2s, height 0.2s, background-color 0.2s;
    }
</style>

<script>
    const dot = document.querySelector(".cursor-dot") as HTMLElement;
    const outline = document.querySelector(".cursor-outline") as HTMLElement;

    if (dot && outline) {
        window.addEventListener("mousemove", (e) => {
            const posX = e.clientX;
            const posY = e.clientY;
            
            dot.style.left = `${posX}px`;
            dot.style.top = `${posY}px`;

            outline.animate({
                left: `${posX}px`,
                top: `${posY}px`
            }, { duration: 500, fill: "forwards" });

            const target = e.target as HTMLElement;
            
            // 逻辑修改：只有真正的“点击类”元素会让准星变绿
            // 输入框（input/textarea）虽然也会隐藏鼠标，但准星保持红色
            const isClickable = target.closest('a') || 
								target.closest('button') || 
								target.closest('.menu-item') ||
								target.closest('input') ||
								target.closest('textarea') ||
								target.classList.contains('social-btn');

            if (isClickable) {
                document.documentElement.style.setProperty('--dot-color', '#00ff00');
            } else {
                document.documentElement.style.setProperty('--dot-color', '#ff4444');
            }
        });

        window.addEventListener("mousedown", () => {
            outline.style.backgroundColor = "rgba(237, 186, 58, 0.2)"; 
            outline.style.width = "28px"; 
            outline.style.height = "28px";
        });
        
        window.addEventListener("mouseup", () => {
            outline.style.backgroundColor = "transparent";
            outline.style.width = "35px"; 
            outline.style.height = "35px";
        });
    }
</script>